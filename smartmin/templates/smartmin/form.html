{% extends "smartmin/base.html" %}

{% load smartmin %}

{% block content %}
{% block pjax %}
<div class="row" id="pjax">
  <div class="{% block form-span %}span9{% endblock %}">
  {% block pre-form %}{% endblock %}

  <form class="smartmin-form" method="post" enctype="multipart/form-data">
    {% block pre-form-errors %}
    {% endblock pre-form-errors %}

    {% if form.non_field_errors %}
    <div class="alert-message error form-errors">
      {{ form.non_field_errors }}
    </div>
    {% endif %}

    {% block post-form-errors %}
    {% endblock post-form-errors %}

    {% block pre-fields %}
    {% endblock %}

    <legend>{% block form-help %}{% endblock form-help %}</legend>

    {% block fields %}
    <fieldset>
    {% for field in fields %}
    {% with form|field:field as form_field %}
    {% getblock "before_field_" field %}

    {% if form_field and form_field.is_hidden %}
    {{ form_field }}
    {% else %}
      {% if form_field %}
      <div class="clearfix form-field {% if form_field.errors %}error{% endif %}">
        <label for="{{ field.name }}">{% get_label field %}</label>
        <div class="input">{{ form_field }}
          {% with view|field_help:field as help %}
          {% if help %}
          <span class="help-block">{{ help }}</span>
          {% endif %}
          {% endwith %}
        
          {% if form_field.errors %}
          <span class="help-block field-errors">{{ form_field.errors }}</span>
          {% endif %}
        </div>
      </div>
      {% else %}
      <div class="clearfix form-field">
        <label for="{{ field.name }}">{% get_label field %}</label>
        <div class="input">
          <span class="uneditable-input">{% get_value_from_view field %}</span>
          {% with view|field_help:field as help %}
          {% if help %}
          <span class="help-block">{{ help }}</span>
          {% endif %}
          {% endwith %}
        </div>
      </div>
      {% endif %}
    {% endif %}

    {% getblock "after_field_" field %}

    {% endwith %}
    {% endfor %}
    </fieldset>
    {% endblock fields %}

    {% block post-fields %}
    {% endblock post-fields %}

    {% csrf_token %}

    {% block form-buttons %}
    <div class="actions">
      <input type="submit" class="btn primary" value="{{ submit_button_name }}">
      <a class="btn" onclick="javascript:history.go(-1)">Cancel</a>
    </div>
    {% endblock %}
  </form>

  {% block post-form %}{% endblock post-form %}
</div>
</div>
{% endblock pjax %}
{% endblock content %}

{% block extra-script %}
{{ block.super }}
{% if javascript_submit %}
<script>
  // attach a submit handler to the form
  $("#smartmin_form").submit(function(event) {
  
  // stop form from submitting normally
  event.preventDefault();
  event.stopPropagation();

  // get some values from elements on the page:
  var form = $(this);
  var data = form.serialize();
  {{ javascript_submit }}(form, data);
  });
</script>
{% endif %}
{% endblock %}
